<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magazzino Ristorante</title>
<style>
body{font-family:Arial;margin:20px;background:#f4f4f4;}
h1{text-align:center;}
.container{max-width:700px;margin:auto;}
.row{display:flex;gap:10px;flex-wrap:wrap}
input,select,button{padding:10px;font-size:16px;margin:5px 0;}
input{flex:1;min-width:140px}
button{cursor:pointer;border:none;border-radius:8px}
.card{background:#fff;padding:15px;margin-top:12px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.stock{font-weight:bold;margin-top:6px}
.totale-box{
  background:#111;color:#fff;padding:15px;border-radius:12px;
  text-align:center;font-size:20px;margin-bottom:15px;
}
.mov-box{
  background:#f9f9f9;padding:12px;border-radius:10px;margin-top:10px;
}
.action-btn{
  background:#007aff;color:white;width:100%;
}
.confirm-btn{
  background:#28a745;color:white;width:100%;
}
.delete-btn{
  background:#dc3545;color:white;margin-top:8px;width:100%;
}
details{margin-top:10px}
ul{margin:8px 0 0 18px}
.pill{background:#eee;border-radius:999px;padding:3px 8px;font-size:12px;margin-left:6px}
</style>
</head>
<body>

<div class="container">
<h1>Magazzino</h1>

<div class="totale-box">
Totale pezzi in magazzino: <span id="totaleMagazzino">0</span>
</div>

<div class="card">
<div class="row">
<input type="text" id="nomeProdotto" placeholder="Nome prodotto">
<input type="number" id="quantitaIniziale" placeholder="Quantità iniziale">
<button onclick="aggiungiProdotto()">Aggiungi</button>
</div>
</div>

<div id="listaProdotti"></div>
</div>

<script>
let prodotti = JSON.parse(localStorage.getItem("magazzino")) || [];

function salva(){
localStorage.setItem("magazzino", JSON.stringify(prodotti));
}

function oggi(){
return new Date().toISOString().split("T")[0];
}

function formatData(d){
if(!d) return "";
const [y,m,g]=d.split("-");
return g+"/"+m+"/"+y;
}

function totale(){
let t=0;
prodotti.forEach(p=> t+=p.quantita);
document.getElementById("totaleMagazzino").innerText=t;
}

function render(){
const lista=document.getElementById("listaProdotti");
lista.innerHTML="";

prodotti.forEach((p,i)=>{

const mov=(p.movimenti||[]).slice().reverse().map(m=>{
const segno=m.tipo==="carico"?"➕":"➖";
return `<li>${segno} <strong>${m.q}</strong> <span class="pill">${m.tipo}</span> - ${formatData(m.data)}</li>`;
}).join("") || "<li>Nessun movimento</li>";

lista.innerHTML+=`
<div class="card">
<div><strong>${p.nome}</strong></div>
<div class="stock">Disponibile: ${p.quantita}</div>

<button class="action-btn" onclick="toggleMov(${i})">Carico / Scarico</button>

<div id="mov-${i}" class="mov-box" style="display:none;">
<select id="tipo-${i}">
<option value="carico">Carico</option>
<option value="scarico">Scarico</option>
</select>
<input type="number" id="q-${i}" placeholder="Quantità">
<input type="date" id="data-${i}" value="${oggi()}">
<button class="confirm-btn" onclick="conferma(${i})">Conferma</button>
</div>

<button class="delete-btn" onclick="elimina(${i})">Elimina prodotto</button>

<details>
<summary>Storico movimenti</summary>
<ul>${mov}</ul>
</details>

</div>
`;
});

totale();
}

function toggleMov(i){
const box=document.getElementById("mov-"+i);
box.style.display= box.style.display==="none" ? "block" : "none";
}

function conferma(i){
const tipo=document.getElementById("tipo-"+i).value;
const q=parseInt(document.getElementById("q-"+i).value);
const data=document.getElementById("data-"+i).value;
if(!q || q<=0) return;

if(tipo==="carico"){
prodotti[i].quantita+=q;
}else{
prodotti[i].quantita-=q;
if(prodotti[i].quantita<0) prodotti[i].quantita=0;
}

prodotti[i].movimenti=prodotti[i].movimenti||[];
prodotti[i].movimenti.push({tipo:tipo,q:q,data:data});

document.getElementById("mov-"+i).style.display="none";

salva();
render();
}

function aggiungiProdotto(){
const nome=document.getElementById("nomeProdotto").value.trim();
const q0=parseInt(document.getElementById("quantitaIniziale").value)||0;
if(nome==="") return;

const nuovo={
nome:nome,
quantita:q0,
movimenti:[]
};

if(q0>0){
nuovo.movimenti.push({tipo:"carico",q:q0,data:oggi()});
}

prodotti.push(nuovo);

document.getElementById("nomeProdotto").value="";
document.getElementById("quantitaIniziale").value="";

salva();
render();
}

function elimina(i){
if(confirm("Sei sicuro?")){
prodotti.splice(i,1);
salva();
render();
}
}

render();
</script>

</body>
</html>
